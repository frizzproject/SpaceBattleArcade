const canvas=document.querySelector("#canvas"),ctx=canvas.getContext("2d"),controlButtons=document.querySelectorAll(".button");let start=!1;diff_easy=!1,diff_medium=!1,diff_hard=!1,screen_mode=0,spawnHeartInt=2e4,switch_control=void 0;let width=800,height=800,timer=0,asteroImg=new Image;asteroImg.src="./sprites/astero.png";let playerShipImg=new Image;playerShipImg.src="./sprites/player-ship.png";let bulletImg=new Image;bulletImg.src="./sprites/bullet.png";let explImg=new Image;explImg.src="./sprites/exp-sprites.png";let healthImg=new Image;healthImg.src="./sprites/health.png";let spaceBackdround=new Image;0===screen_mode?spaceBackdround.src="./sprites/space-background.png":spaceBackdround.src="./sprites/space-background-16_9.png";let menuThemeSwitch=!0;function loadAudio(e,t,i,a){const s=document.createElement("audio");for(let t=0;t<e.length;t++){const i=document.createElement("source");i.src=e[t],s.append(i)}s.volume=t||1,s.loop=i,s.autoplay=a;let o={dom:!1,state:"stop",play:function(){this.dom.play(),this.state="play"},pause:function(){this.dom.pause(),this.state="pause"},stop:function(){this.dom.pause(),this.dom.currentTime=0,this.state="stop"}};return o.dom=s,o}let animationGameLoop=requestAnimationFrame||mozRequestAnimationFrame||webkitRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame||function(e){window.setInterval(e,1e3/60)};function gameLoop(){update(),render(),animationGameLoop(gameLoop)}function update(){timer++,0==dead&&(diff_easy?(start=!0,moveAstero(-2,2,1,2,10)):diff_medium?(start=!0,spawnHeartInt=randomValue(1e4,2e4),moveAstero(-3,3,2,4,6)):diff_hard&&(start=!0,spawnHeartInt=randomValue(1e4,2e4),moveAstero(-4,4,4,6,3)),0===switch_control?mouseMovePlayer():switch_control,moveHearts(),createFire(),moveFire(),animCollision())}spaceBackdround.addEventListener("load",(()=>{canvas.width=width,canvas.height=height,controlButtons.forEach((e=>{e.addEventListener("click",(t=>{if(e.classList.contains("_easy")&&(selectSound.stop(),selectSound.play(),null!=switch_control?(console.log("difficult easy./app."),document.querySelector(".game__menu").classList.add("_hidden"),menuTheme.stop(),battleTheme.play(),diff_easy=!0):alert("Before starting the game choose a control method")),e.classList.contains("_medium")&&(selectSound.stop(),selectSound.play(),null!=switch_control?(console.log("difficult medium./app."),document.querySelector(".game__menu").classList.add("_hidden"),menuTheme.stop(),battleTheme.play(),diff_medium=!0):alert("Before starting the game choose a control method")),e.classList.contains("_hard")&&(selectSound.stop(),selectSound.play(),null!=switch_control?(console.log("difficult hard./app."),document.querySelector(".game__menu").classList.add("_hidden"),menuTheme.stop(),battleTheme.play(),diff_hard=!0):alert("Before starting the game choose a control method")),e.classList.contains("music-switch")&&(menuThemeSwitch?(selectSound.stop(),selectSound.play(),menuTheme.stop(),e.classList.remove("_active"),e.textContent="menu music",menuThemeSwitch=!menuThemeSwitch):(selectSound.stop(),selectSound.play(),menuTheme.play(),e.classList.add("_active"),e.textContent="mute",menuThemeSwitch=!menuThemeSwitch)),e.classList.contains("win-mode")&&(document.querySelector(".game__box").classList.toggle("_fullscreen"),document.querySelector(".game__box").classList.contains("_fullscreen")?(document.querySelector(".wrapper").style.display="block",screen_mode=1):(document.querySelector(".wrapper").style.display="flex",screen_mode=0),0===screen_mode?spaceBackdround.src="./app/sprites/space-background.png":spaceBackdround.src="./app/sprites/space-background-16_9.png"),e.classList.contains("controling")){let e=t.target;e.classList.contains("_mouse")&&(switch_control=0,document.querySelector("._keyboards").classList.remove("_select-k"),document.querySelector(".line").classList.add("line-s"),selectSound.stop(),selectSound.play(),e.classList.add("_select-m"),console.log("Select mouse switching")),e.classList.contains("_keyboards")&&(switch_control=1,document.querySelector("._mouse").classList.remove("_select-m"),document.querySelector(".line").classList.add("line-s"),selectSound.stop(),selectSound.play(),e.classList.add("_select-k"),console.log("Select keyboard switching"))}e.classList.contains("_back")&&(console.log("back to menu./app."),document.querySelector(".game__lose").classList.add("_hidden"),selectSound.play(),setTimeout((()=>{window.location.reload()}),300))}))})),gameLoop()}));let checkHealthInterval=setInterval((()=>{checkCollision()}),250),spawnHearth=setInterval((()=>{start&&(spawnHeartInt=Math.round(randomValue(1e3,5e3)),createHearts(-1,1,1,1))}),spawnHeartInt);function render(){for(i in 1===screen_mode?(width=window.innerWidth,height=window.innerHeight,canvas.width=width,canvas.height=height):(width=800,height=800,canvas.width=width,canvas.height=height),ctx.drawImage(spaceBackdround,0,0,width,height),fire)ctx.drawImage(bulletImg,fire[i].x,fire[i].y,fire[i].width,fire[i].height);for(i in ctx.drawImage(playerShipImg,playerShip.x,playerShip.y,playerShip.width,playerShip.height),astero)ctx.drawImage(asteroImg,astero[i].x,astero[i].y,astero[i].width,astero[i].height);for(i in hearts)ctx.drawImage(healthImg,hearts[i].x,hearts[i].y,hearts[i].width,hearts[i].height);for(i in expl)ctx.drawImage(explImg,170*Math.floor(expl[i].animX),170*Math.floor(expl[i].animY),170,170,expl[i].x,expl[i].y,expl[i].width,expl[i].height);for(i in health)ctx.drawImage(healthImg,health[i].x,health[i].y,health[i].width,health[i].height);drawText(`Score: ${score}`,20,35,"22px","#fff")}let dead=!1,collision=!1,isMouseDown=!1,score=0,astero=[],fire=[],expl=[],health=[],hearts=[],fireDX=0,fireDY=-5,fireWidth=10,fireHeight=45,freqSFire=20,asteroY=-100,asteroDX=1,asteroDY=1,asteroWidth=65,asteroHeight=65,healthX=20,healthY=55,healthWidth=25,healthHeight=22,quanituHealth=3,heartY=-100,heartWidth=25,heartHeight=22,heartDX=1,heartDY=1,playerShip={x:width/2-50,y:height/2-30,width:100,height:60};canvas.onmousedown=function(){isMouseDown=!0},canvas.onmouseup=function(){isMouseDown=!isMouseDown};let drawText=(e,t,i,a,s)=>{ctx.fillStyle=s,ctx.font=`${a} Joystix Monospace`,ctx.fillText(e,t,i),ctx.textBaseline="top"},createHealth=function(){for(let e=0;e<quanituHealth;e++)health.push({x:healthX,y:healthY,width:healthWidth,height:healthHeight}),healthX+=35}();function mouseMovePlayer(){canvas.addEventListener("mousemove",(e=>{playerShip.x=e.offsetX-playerShip.width/2,playerShip.y=e.offsetY-playerShip.height/2}))}function createHearts(e,t,i,a){hearts.push({x:Math.random()*(width-heartWidth-1)+1,y:heartY,dx:heartDX,dy:heartDY,speedX:Math.random()*(t-e+1)+e,speedY:Math.random()*(a-i+1)+i,width:heartWidth,height:heartHeight,add:!1})}function moveHearts(){if(0!=hearts)for(i in hearts)hearts[i].y+=hearts[i].dy*hearts[i].speedY,hearts[i].x+=hearts[i].dx*hearts[i].speedX,(hearts[i].x>=width-hearts[i].width||hearts[i].x<=0)&&(hearts[i].dx=-hearts[i].dx),hearts[i].y>height+hearts[i].height&&hearts.splice(i,1)}function createFire(){isMouseDown&&timer%freqSFire==0&&(shotSound.stop(),shotSound.play(),fire.push({x:playerShip.x+playerShip.width/2-5,y:playerShip.y,dx:fireDX,dy:fireDY,width:fireWidth,height:fireHeight}))}function moveFire(){for(i in fire)0!=fire&&(fire[i].y+=fire[i].dy,fire[i].x+=fire[i].dx,fire[i].y<-fire[i].h&&fire.splice(i,1))}function checkCollision(){for(i in astero)astero[i].x+astero[i].width/1.4>=playerShip.x&&astero[i].x<=playerShip.x+playerShip.width/1.4&&astero[i].y+astero[i].height/1.4>=playerShip.y&&astero[i].y<=playerShip.y+playerShip.height/1.4&&(collision=!0,astero[i].del=!0,expl.push({x:astero[i].x,y:astero[i].y,width:110,height:110,animX:0,animY:0}),astero[i].del&&(astero.splice(i,1),explSound.stop(),explSound.play()),collision&&health.length>0&&(removeHealthSound.stop(),removeHealthSound.play(),quanituHealth--,health.pop()),collision&&0==health.length&&(start=!1,dead=!0,battleTheme.stop(),gameOverSound.play(),document.querySelector(".game__lose").classList.remove("_hidden"),document.querySelector(".score").textContent=score,console.log("Oops!It seems you lost^-^")));for(i in hearts)hearts[i].x+hearts[i].width>=playerShip.x&&hearts[i].x<=playerShip.x+playerShip.width/1.4&&hearts[i].y+hearts[i].height>=playerShip.y&&hearts[i].y<=playerShip.y+playerShip.height/1.4&&health.length<3&&hearts.splice(i,1)}function animCollision(){for(i in expl)expl[i].animX=expl[i].animX+.3,expl[i].animX>6&&(expl[i].animY++,expl[i].animX=0),expl[i].animY>6&&expl.splice(i,1)}function moveAstero(e,t,a,s,o){for(i in timer%o==0&&astero.push({x:Math.random()*(width-asteroWidth-1)+1,y:asteroY,dx:asteroDX,dy:asteroDY,width:asteroWidth,height:asteroHeight,speedX:Math.random()*(t-e+1)+e,speedY:Math.random()*(s-a+1)+a,angle:0,del:!1}),astero){for(j in astero[i].x+=astero[i].dx*astero[i].speedX,astero[i].y+=astero[i].dy*astero[i].speedY,(astero[i].x>=width-astero[i].width||astero[i].x<=0)&&(astero[i].dx=-astero[i].dx),astero[i].y>=height+astero[i].height&&astero.splice(i,1),fire)if(Math.abs(astero[i].x+astero[i].width/2-fire[j].x-fire[j].width/2)<astero[i].width&&Math.abs(astero[i].y-fire[j].y)<astero[i].height){explSound.stop(),expl.push({x:astero[i].x,y:astero[i].y,width:110,height:110,animX:0,animY:0}),astero[i].del=!0,fire.splice(j,1),explSound.play(),score++;break}astero[i].del&&astero.splice(i,1)}}function randomValue(e,t){return Math.random()*(t-e+1)+e}let customCursor=function(){const e=document.querySelector(".cursor-point"),t=document.querySelector(".cursor");document.addEventListener("mousemove",(i=>{let a=i.pageX,s=i.pageY,o=i.target;o==document.getElementById("canvas")?(e.style.display="none",t.style.display="none"):(e.style.display="block",t.style.display="block"),e.style.left=a+"px",e.style.top=s+"px",setTimeout((()=>{t.style.left=a+"px",t.style.top=s+"px"}),50),o.closest(".button")?(t.classList.add("cursor_active"),e.classList.add("cursor-point_active")):(t.classList.remove("cursor_active"),e.classList.remove("cursor-point_active"))}))}();