const e=document.querySelector("#canvas"),t=e.getContext("2d"),o=document.querySelectorAll(".button");let s=!1;diff_easy=!1,diff_medium=!1,diff_hard=!1,screen_mode=0,spawnHeartInt=2e4,menuThemeSwitch=!1;let a=800,n=800,d=0,l=new Image;l.src="./sprites/astero.png";let c=new Image;c.src="./sprites/player-ship.png";let r=new Image;r.src="./sprites/bullet.png";let u=new Image;u.src="./sprites/exp-sprites.png";let h=new Image;h.src="./sprites/health.png";let m=new Image;0===screen_mode?m.src="./sprites/space-background.png":m.src="./sprites/space-background-16_9.png";let p=S(["./audio/menu/menu-sound.mp3","./audio/menu/menu-sound.wav","./audio/menu/menu-sound.ogg"],.2,!0,!1),g=S(["./audio/battle/battle-sound.mp3","./audio/battle/battle-sound.wav","./audio/battle/battle-sound.ogg"],.1,!0),y=S(["./audio/shot/shot-sound.mp3","./audio/shot/shot-sound.wav","./audio/shot/shot-sound.ogg"],.2),f=S(["./audio/expl/expl-sound.mp3","./audio/expl/expl-sound.wav","./audio/expl/expl-sound.ogg"],.2),w=S(["./audio/health/remove-health.mp3","./audio/health/remove-health.wav","./audio/health/remove-health.ogg"],.2),x=S(["./audio/health/add-health.mp3","./audio/health/add-health.wav","./audio/health/add-health.ogg"],.4),_=S(["./audio/select/select-sound.mp3","./audio/select/select-sound.wav","./audio/select/select-sound.ogg"],.2),v=S(["./audio/menu/game-over.mp3","./audio/menu/game-over.wav","./audio/menu/game-over.ogg"],.4);function S(e,t,i,o){const s=document.createElement("audio");for(let t=0;t<e.length;t++){const i=document.createElement("source");i.src=e[t],s.append(i)}s.volume=t||1,s.loop=i,s.autoplay=o;let a={dom:!1,state:"stop",play:function(){this.dom.play(),this.state="play"},pause:function(){this.dom.pause(),this.state="pause"},stop:function(){this.dom.pause(),this.dom.currentTime=0,this.state="stop"}};return a.dom=s,a}let I=requestAnimationFrame||mozRequestAnimationFrame||webkitRequestAnimationFrame||oRequestAnimationFrame||msRequestAnimationFrame||function(e){window.setInterval(e,1e3/60)};function b(){d++,0==L&&(diff_easy?(s=!0,B(-2,2,1,2,10)):diff_medium?(s=!0,spawnHeartInt=N(1e4,2e4),B(-3,3,2,4,6)):diff_hard&&(s=!0,spawnHeartInt=N(1e4,2e4),B(-4,4,4,6,3)),e.addEventListener("mousemove",(e=>{C.x=e.offsetX-C.width/2,C.y=e.offsetY-C.height/2})),function(){if(0!=H)for(i in H)H[i].y+=H[i].dy*H[i].speedY,H[i].x+=H[i].dx*H[i].speedX,(H[i].x>=a-H[i].width||H[i].x<=0)&&(H[i].dx=-H[i].dx),H[i].y>n+H[i].height&&H.splice(i,1)}(),M&&d%20==0&&(y.stop(),y.play(),T.push({x:C.x+C.width/2-5,y:C.y,dx:0,dy:-5,width:10,height:45})),function(){for(i in T)0!=T&&(T[i].y+=T[i].dy,T[i].x+=T[i].dx,T[i].y<-T[i].h&&T.splice(i,1))}(),function(){for(i in E)E[i].animX=E[i].animX+.3,E[i].animX>6&&(E[i].animY++,E[i].animX=0),E[i].animY>6&&E.splice(i,1)}()),function(){1===screen_mode?(a=window.innerWidth,n=window.innerHeight,e.width=a,e.height=n):(a=800,n=800,e.width=a,e.height=n);for(i in t.drawImage(m,0,0,a,n),T)t.drawImage(r,T[i].x,T[i].y,T[i].width,T[i].height);for(i in t.drawImage(c,C.x,C.y,C.width,C.height),Y)t.drawImage(l,Y[i].x,Y[i].y,Y[i].width,Y[i].height);for(i in H)t.drawImage(h,H[i].x,H[i].y,H[i].width,H[i].height);for(i in E)t.drawImage(u,170*Math.floor(E[i].animX),170*Math.floor(E[i].animY),170,170,E[i].x,E[i].y,E[i].width,E[i].height);for(i in A)t.drawImage(h,A[i].x,A[i].y,A[i].width,A[i].height);J(`Score: ${X}`,20,35,"18px","#fff"),J(`Record: ${k}`,20,45,"18px","#fff")}(),I(b)}m.addEventListener("load",(()=>{e.width=a,e.height=n,o.forEach((e=>{e.addEventListener("click",(t=>{e.classList.contains("_easy")&&(_.stop(),_.play(),console.log("difficult easy"),document.querySelector(".game__menu").classList.add("_hidden"),p.stop(),g.play(),diff_easy=!0),e.classList.contains("_medium")&&(_.stop(),_.play(),console.log("difficult medium"),document.querySelector(".game__menu").classList.add("_hidden"),p.stop(),g.play(),diff_medium=!0),e.classList.contains("_hard")&&(_.stop(),_.play(),console.log("difficult hard"),document.querySelector(".game__menu").classList.add("_hidden"),p.stop(),g.play(),diff_hard=!0),e.classList.contains("music-switch")&&(menuThemeSwitch?(_.stop(),_.play(),p.stop(),e.classList.remove("_active"),e.textContent="menu music",menuThemeSwitch=!menuThemeSwitch):(_.stop(),_.play(),p.play(),e.classList.add("_active"),e.textContent="mute",menuThemeSwitch=!menuThemeSwitch)),e.classList.contains("win-mode")&&(document.querySelector(".game__box").classList.toggle("_fullscreen"),document.querySelector(".game__box").classList.contains("_fullscreen")?(document.querySelector(".wrapper").style.display="block",screen_mode=1):(document.querySelector(".wrapper").style.display="flex",screen_mode=0),0===screen_mode?m.src="./sprites/space-background.png":m.src="./sprites/space-background-16_9.png"),e.classList.contains("_back")&&(console.log("back to menu "),document.querySelector(".game__lose").classList.add("_hidden"),_.play(),setTimeout((()=>{window.location.reload()}),300))}))})),b()}));setInterval((()=>{!function(){for(i in Y)Y[i].x+Y[i].width/1.4>=C.x&&Y[i].x<=C.x+C.width/1.4&&Y[i].y+Y[i].height/1.4>=C.y&&Y[i].y<=C.y+C.height/1.4&&(q=!0,Y[i].del=!0,E.push({x:Y[i].x,y:Y[i].y,width:110,height:110,animX:0,animY:0}),Y[i].del&&(Y.splice(i,1),f.stop(),f.play()),q&&A.length>0&&(w.stop(),w.play(),R--,A.pop()),q&&0==A.length&&(s=!1,L=!0,g.stop(),v.play(),document.querySelector(".game__lose").classList.remove("_hidden"),document.querySelector(".score").textContent=X,console.log("Oops!It seems you lost^-^"),X>=k&&$("set","record_score",X)));for(i in H)H[i].x+H[i].width>=C.x&&H[i].x<=C.x+C.width/1.4&&H[i].y+H[i].height>=C.y&&H[i].y<=C.y+C.height/1.4&&A.length<3&&(H.splice(i,1),R++,A=[],F=20,x.play(),O())}()}),250),setInterval((()=>{var e,t,i,o;s&&(spawnHeartInt=Math.round(N(1e3,5e3)),e=-1,t=1,i=1,o=1,H.push({x:Math.random()*(a-25-1)+1,y:-100,dx:1,dy:1,speedX:Math.random()*(t-e+1)+e,speedY:Math.random()*(o-i+1)+i,width:25,height:22,add:!1}))}),spawnHeartInt);let L=!1,q=!1,M=!1,X=0,k=localStorage.getItem("record_score")?localStorage.getItem("record_score"):0,Y=[],T=[],E=[],A=[],H=[],F=20,R=3,C={x:a/2-50,y:n/2-30,width:100,height:60};e.onmousedown=function(){M=!0},e.onmouseup=function(){M=!M};let J=(e,i,o,s,a)=>{t.fillStyle=a,t.font=`${s} Joystix Monospace`,t.fillText(e,i,o),t.textBaseline="top"};function O(){for(let e=0;e<R;e++)A.push({x:F,y:75,width:25,height:22}),F+=35}function $(e,t,i){"set"===e?localStorage.setItem(t,JSON.stringify(i)):localStorage.getItem(t,JSON.parse(i))}function B(e,t,o,s,l){for(i in d%l==0&&Y.push({x:Math.random()*(a-65-1)+1,y:-100,dx:1,dy:1,width:65,height:65,speedX:Math.random()*(t-e+1)+e,speedY:Math.random()*(s-o+1)+o,angle:0,del:!1}),Y){for(j in Y[i].x+=Y[i].dx*Y[i].speedX,Y[i].y+=Y[i].dy*Y[i].speedY,(Y[i].x>=a-Y[i].width||Y[i].x<=0)&&(Y[i].dx=-Y[i].dx),Y[i].y>=n+Y[i].height&&Y.splice(i,1),T)if(Math.abs(Y[i].x+Y[i].width/2-T[j].x-T[j].width/2)<Y[i].width&&Math.abs(Y[i].y-T[j].y)<Y[i].height){f.stop(),E.push({x:Y[i].x,y:Y[i].y,width:110,height:110,animX:0,animY:0}),Y[i].del=!0,T.splice(j,1),f.play(),X++;break}Y[i].del&&Y.splice(i,1)}}function N(e,t){return Math.random()*(t-e+1)+e}O();!function(){const e=document.querySelector(".cursor-point"),t=document.querySelector(".cursor");document.addEventListener("mousemove",(i=>{let o=i.pageX,s=i.pageY,a=i.target;a==document.getElementById("canvas")?(e.style.display="none",t.style.display="none"):(e.style.display="block",t.style.display="block"),e.style.left=o+"px",e.style.top=s+"px",setTimeout((()=>{t.style.left=o+"px",t.style.top=s+"px"}),50),a.closest(".button")?(t.classList.add("cursor_active"),e.classList.add("cursor-point_active")):(t.classList.remove("cursor_active"),e.classList.remove("cursor-point_active"))}))}();